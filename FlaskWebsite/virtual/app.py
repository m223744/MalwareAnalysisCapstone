from flask import Flask, render_template, request, redirect
from flask_sqlalchemy import SQLAlchemy 
from datetime import datetime




app = Flask(__name__)
db_name = "test.db"

#Initialize app & set relative path where database is located
app.config["SQLALCEHMY_DATABASE_URI"] = "sqlite:///test.db"
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = True

#Initialize database
db = SQLAlchemy(app) 

#Database model
class test(db.Model):
	id = db.Column(db.Integer, primary_key=True)
	#Might need more than 200 char
	file = db.Column(db.String(500), nullable=False)
	date_created = db.Column(db.DateTime, default=datetime.utcnow)

	#Returns string once something is added
	def __repr__(self):
		return '<File %r>' % self.id

@app.route('/')
def index():
	return render_template("index.html")


@app.route('/about')
def about():
	return render_template("about.html")


@app.route('/submit')
def submit():
	title = "Submit your file(s) here"
	return render_template("submit.html", title=title)


@app.route('/form', methods=["POST", "GET"])
def form(): 
	file_name = request.form.get("execFile")

	if request.method=="POST":
		file_name = request.form["execFile"]
		new_file = test(file=file_name)
		

		#Add to database
		try:
			db.session.add(new_file)
			#db.session.commit()
			return "Added to db"
		except: 
			return "Error adding file"
		'''
		try:
			db.session.add(new_file)
			db.session.commit()
			return redirect("/form")
		'''
		
		


	else:
		files = test.query.order_by(test.date_created)
		return render_template("form.html", file_name=file_name, files=files)
