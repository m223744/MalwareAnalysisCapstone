#!/bin/bash

#script call ghidra headless and provide a script with an option of an output file for post-analysis
#$1 binary
#$2 output file
#$3 ghidra path
# $4 decompile Script Path

GHIDRA_PATH=$2
SCRIPT_PATH=$3
OUTPUT_FILE=$4
BINARY_FILE=$1

if [ "$#" -ne    4 ]
then
    echo "USAGE: $0 <binary file> <ghidra directory path> <script> <output file>"
    echo ""
    echo "Description:"
    echo "  Open an instance of headless Ghidra, passing a script for post analysis and a path to an output file for the script."
    exit
fi

#remove gpr and rep files first (CAREFUL!)
rm -rf *.gpr *.rep

time $GHIDRA_PATH/support/analyzeHeadless . tmp_ghidra_project -import $BINARY_FILE -postscript $SCRIPT_PATH +o $OUTPUT_FILE


rm -rf *.gpr *.rep
